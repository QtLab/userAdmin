<style type="text/css">
    .ui-languageSelector-container {
        padding: 1em;
        background-image: none !important;
    }

    .ui-languageSelector-container ul.ui-languageSelector-list {
        border-width: 0;
    }
</style>

<div class="ui-languageSelector">

    <div class="ui-languageSelector-messages"></div>
    <div class="ui-languageSelector-container ui-state-default">
        <h3>Select your preferred language</h3>
        <ul class="ui-languageSelector-list ui-menuTree ui-state-default ui-menuList ui-widget-content ui-corner-all" style="overflow: hidden;">
            {{#each itemList}}
            <li class="ui-menuList-item ui-widget-content ui-corner-all" 
                data-language-id="{{this.id}}">
                <div class="ui-menuList-itemLink {{#if this.selected }} ui-state-active {{else}} ui-state-default {{/if}}">
                    <span class="ui-menuList-link">{{this.name}}</span>
                    <div class="ui-helper-clearfix"></div>
                </div>
            </li>
            {{/each}}
        </ul>
    </div>
</div>


<script>
    require(["jquery", "jqueryui", "/public/scripts/Template.Widget.ItemPicker.js"],
       function ($, jqUI) {

           jQuery('div.ui-languageSelector:first').itemPicker({
               messageBoxSelector: 'div.ui-languageSelector-messages:first',
               itemsSelector: 'ul.ui-languageSelector-list:first > li',
               itemsAttrId: 'data-language-id',
               itemApllyingMsg: 'Aplicando idioma...',
               itemApllyingFailUnhandledMsg: 'Error no controlado aplicando el idioma',
               itemServerPut: function (itemId) {
                   return jQuery.ajax({
                       url: "/languages/",
                       type: "PUT",
                       data: JSON.stringify({ newValue: itemId }),
                       cache: false
                   });
               },
               itemServerPutOk: function (result) {
                   location.reload();
               },
           });

       });
</script>