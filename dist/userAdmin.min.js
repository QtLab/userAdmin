/*! userAdmin 05-12-2014 */
function getLogger(a){var b=a.filename.split("/").slice(-2).join("/");return new winston.Logger({transports:[new winston.transports.Console({colorize:!0,level:"debug",label:b})]})}!function(a){"use strict";var b=require("passport"),c=require("passport-http").BasicStrategy,d=require("../models/users");b.use(new c(function(a,b,c){d.findOne({username:a},function(a,d){return a?c(a):d?void d.verifyPassword(b,function(a,b){return a?c(a):b?c(null,d):c(null,!1)}):c(null,!1)})})),a.exports.isAuthenticated=b.authenticate("basic",{session:!1})}(module),function(a){"use strict";a.exports.setRoutes=function(a,b){a.use(function(a,c){b.info("Not found URL: %s",a.url),c.status(404),c.send({})}),a.use(function(a,c,d,e){return a?(console.log(a.message),console.log(a.stack),b.error(a),d.status(a.status||500),void d.send({})):e()})},a.exports.setAccessControlOrigin=function(a){a.use(function(a,b,c){b.setHeader("Access-Control-Allow-Origin","*"),b.setHeader("Access-Control-Allow-Methods","GET, POST, OPTIONS, PUT, PATCH, DELETE"),b.setHeader("Access-Control-Allow-Headers","X-Requested-With,content-type"),b.setHeader("Access-Control-Allow-Credentials",!0),b.setHeader("Access-Control-Allow-Headers","Authorization"),c()})}}(module),function(a){"use strict";a.exports.setRoutes=function(a){a.get("/",function(a,b){b.sendFile("public/index.html",{root:__dirname})})}}(module),function(a){"use strict";function b(a,b){var d=new c(a),e={isValid:null,messages:[],userId:null};c.findOne({username:d.username},function(a,c){a&&b(a),c?(e.isValid=!1,e.messages.push("User already exists"),b(null,e)):d.save(function(a,c){a?b(a):(e.isValid=!0,e.userId=c.userId,e.messages.push("User created"),b(null,e))})})}var c=(require("../libs/log")(a),require("../models/users"));a.exports.create=b,a.exports.setRoutes=function(a,c){a.get("/api/user",c.isAuthenticated,function(a,b){b.json({user:a.user})}),a.post("/api/user",function(a,c,d){b(a.body,function(a,b){a?d(a):c.json(b)})})}}(module);var config=require("nconf"),p="src/config.json";console.log(p),config.argv().env().file({file:p}),module.exports=config;var mongoose=require("mongoose"),log=require("../libs/log")(module),config=require("../libs/config");mongoose.connect(process.env.CUSTOMCONNSTR_MONGOLAB_URI||config.get("mongoose:uri"));var db=mongoose.connection;db.on("error",function(a){log.error("connection error:",a.message)}),db.once("open",function(){log.info("Connected to DB!")}),module.exports.mongoose=mongoose;var winston=require("winston");module.exports=getLogger,function(a){"use strict";var b=require("mongoose"),c=require("bcrypt-nodejs"),d=new b.Schema({username:{type:String,unique:!0,required:!0},password:{type:String,required:!0}});d.virtual("userId").get(function(){return this.id}),d.pre("save",function(a){var b=this;return b.isModified("password")?void c.genSalt(5,function(d,e){return d?a(d):void c.hash(b.password,e,null,function(c,d){return c?a(c):(b.password=d,void a())})}):a()}),d.methods.verifyPassword=function(a,b){c.compare(a,this.password,function(a,c){return a?b(a):void b(null,c)})},a.exports=b.model("User",d)}(module),function(a){"user strict";var b=require("express"),c=require("serve-favicon"),d=require("method-override"),e=(require("path"),require("compression")),f=require("passport"),g=require("body-parser"),h=require("./libs/config"),i=(require("./libs/db").mongoose,require("./libs/log")(a)),j=require("./controllers/auth"),k=require("./controllers/home"),l=require("./controllers/users"),m=require("./controllers/common"),n=b();n.set("port",process.env.PORT||h.get("port")),n.use(c(__dirname+"/public/favicon.ico")),n.use(g.urlencoded({extended:!0})),n.use(g.json()),n.use(f.initialize()),n.use(d("X-HTTP-Method-Override")),n.use(e()),n.use(b.static(__dirname+"/public",{maxAge:"production"===process.env.NODE_ENV?864e5:0})),("test"===process.env.NODE_ENV||"dev"===process.env.NODE_ENV)&&m.setAccessControlOrigin(n),k.setRoutes(n),l.setRoutes(n,j),m.setRoutes(n,i),process.on("uncaughtException",function(a){try{i.error(a)}catch(b){try{i.error(a)}catch(c){}}process.exit(1)}),n.listen(n.get("port"),function(){i.info("Express server listening on port "+n.get("port"))})}(module);